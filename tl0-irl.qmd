```{r irl_ctry}
ctry <- "IRL"
ctry2 <- "Ireland"
```

# Ireland

```{r irl_pkgs}
library(oecdcountryprofiles)
library(dplyr)
library(tidyr)
library(ggplot2)
library(patchwork)
library(oecdplot)
library(knitr)
library(readxl)
library(janitor)
library(stringr)
library(readr)
library(tintin)
library(scales)
library(plotly)

load_oecd_fonts()

missing_reg <- c("ITG2F")
excl_countries <- c("LUX", "IRL")

clrs <- tintin_colours$the_black_island
clrs2 <- tintin_colours$the_blue_lotus
clrs3 <- tintin_colours$the_red_sea_sharks
clrs4 <- tintin_colours$the_calculus_affair
clrs5 <- tintin_colours$red_rackhams_treasure
```

<table style="margin-left:66.1pt;border-collapse:collapse" cellspacing="0" cellpadding="0" border="0">
<tbody>
<tr>
<td style="width:467.5pt;border:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt" width="623" valign="top">
<p class="MsoNormal" style="background:#fff9e6">
<b><span style="font-size:9.0pt;color:#212529">OECD Regional Outlook</span></b><u></u><u></u></p>
<p class="MsoNormal" style="margin:2.4pt;background:white"><span style="font-size:9.0pt;color:#212529">The OECD
<a href="https://www.oecd-ilibrary.org/urban-rural-and-regional-development/oecd-regional-outlook_2dafc8cf-en" target="_blank"><i><span style="color:#0d6efd">Regional Outlook</span></i></a> reviews recent trends, policy developments, and prospects across OECD regions, including the underlying causes driving regional inequalities in performance and well-being. The report offers evidence,
 guidance and policy recommendations on how to improve competitiveness and productivity, promote inclusive growth, accelerate the net-zero transition and raise well-being standards through effective regional development policy and multi-level governance.</span><u></u><u></u></p>
</td>
</tr>
</tbody>
</table>

## Overview

```{r irl_tbl}
read_html_table(ctry)
```

## Regional inequality trends

```{r fig3}
# read ----

finp <- if (any(ctry %in% c("AUS", "CAN", "COL", "CHE", "CHL", "IRL", "MEX"))) {
  "data/countryprofile_option1_addon.xlsx"
} else {
  "data/countryprofile_option1.xlsx"
}

dp1 <- read_excel(finp, sheet = ctry) %>%
  clean_names()

# tidy ----

colnames(dp1) <- str_replace(colnames(dp1), tolower(ctry), "country")

dp11 <- dp1 %>%
  select(time, matches("country")) %>%
  pivot_longer(-time) %>%
  rename(value_country = value)

dp11 <- dp11 %>%
  mutate(
    name = case_when(
      name == "pw_lp_country" ~ "Lower half",
      name == "pw_hp_country" ~ "Upper half"
    )
  )

# plot ----

yrs <- sort(unique(dp11$time))
yrs <- seq(min(yrs), max(yrs), 2)

hpgrew <- dp11 %>%
  filter(
    name == "Upper half",
    time %in% c(min(yrs), max(yrs))
  ) %>%
  summarise(grew = 100 * (value_country - lag(value_country)) / lag(value_country)) %>%
  drop_na() %>%
  pull() %>%
  round(1)

lpgrew <- dp11 %>%
  filter(
    name == "Lower half",
    time %in% c(min(yrs), max(yrs))
  ) %>%
  summarise(grew = 100 * (value_country - lag(value_country)) / lag(value_country)) %>%
  drop_na() %>%
  pull() %>%
  round(1)

hpdiff <- hpgrew - lpgrew

hpmore <- ifelse(hpdiff > 0, "more", "less")

fig3_1 <- ggplot(dp11) +
  geom_line(aes(x = time, y = value_country, color = name), linewidth = 1.2) +
  # theme_oecd(base_size = 10) +
  theme_minimal() +
  scale_colour_manual(values = c("#177dc7","#508551")) +
  labs(
    x = "", y = "Productivity (2015 USD PPP)", colour = "Series",
    title = "Figure 1: Evolution of labour productivity, TL2 regions"
  ) +
  scale_x_continuous(labels = as.character(yrs), breaks = yrs) +
  scale_y_continuous(labels = scales::number_format())
```

In `r ctry2`, labour productivity in high-productivity regions grew by `r hpgrew`% between `r min(yrs)` and `r max(yrs)`, `r abs(hpdiff)` percentage points `r hpmore` compared to low-productivity regions.

```{r fig3_2}
ggplotly(fig3_1) %>%
  config(displayModeBar = F)
```

<div class="oecdnote">
**Note**: Labour productivity for high productivity (low productivity) regions is equal to the sum of Gross Value Added across high productivity (low productivity) regions in a country/year divided by the sum of Employment across high productivity (low productivity) regions in a country/year. Gross Value Added is expressed in USD 2015 PPP. Regions are at the TL2 level for Australia, Canada, Chile, Colombia, Ireland, Mexico, Norway, Switzerland, Turkey and the United States. A region is defined as high productivity if its productivity was equal or above the country median for at least two years out of the first four years of each region’ observation period, and low productivity otherwise. The starting year is the first available year for each country.

**Source**: OECD Regional Database (2022).
</div>

```{r fig4}
# read ----

finp <- if (any(ctry %in% c("AUS", "CAN", "COL", "CHE", "CHL", "IRL", "MEX"))) {
  "data/countryprofile_option2_addon.xlsx"
} else {
  "data/countryprofile_option2.xlsx"
}

dp2 <- read_excel(finp, sheet = ctry) %>%
  clean_names()

# tidy ----

colnames(dp2) <- str_replace(colnames(dp2), tolower(ctry), "country")

dp21 <- dp2 %>%
  select(time, matches("country")) %>%
  pivot_longer(-time) %>%
  rename(value_country = value)

dp21 <- dp21 %>%
  mutate(
    name = case_when(
      name == "share_tgoods_lp_country" ~ paste(ctry, "TG LP"),
      name == "share_tgoods_hp_country" ~ paste(ctry, "TG HP"),
      name == "share_tserv_lp_country" ~ paste(ctry, "TS LP"),
      name == "share_tserv_hp_country" ~ paste(ctry, "TS HP")
    )
  )

# plot ----

yrs <- sort(unique(dp21$time))
yrs <- seq(min(yrs), max(yrs), 1)

tghpgrew <- dp21 %>%
  filter(
    name == paste(ctry, "TG HP"),
    time %in% c(min(yrs), max(yrs))
  ) %>%
  summarise(grew = value_country - lag(value_country)) %>%
  drop_na() %>%
  pull() %>%
  round(1)

tglpgrew <- dp21 %>%
  filter(
    name == paste(ctry, "TG LP"),
    time %in% c(min(yrs), max(yrs))
  ) %>%
  summarise(grew = value_country - lag(value_country)) %>%
  drop_na() %>%
  pull() %>%
  round(1)

tghpdiff <- tghpgrew - tglpgrew
tghpmore <- ifelse(tghpdiff > 0, "grew", "declined")

tglpdiff <- tglpgrew - tglpgrew
tglpmore <- ifelse(tglpdiff > 0, "grew", "declined")

tshpgrew <- dp21 %>%
  filter(
    name == paste(ctry, "TS HP"),
    time %in% c(min(yrs), max(yrs))
  ) %>%
  summarise(grew = value_country - lag(value_country)) %>%
  drop_na() %>%
  pull() %>%
  round(1)

tslpgrew <- dp21 %>%
  filter(
    name == paste(ctry, "TS LP"),
    time %in% c(min(yrs), max(yrs))
  ) %>%
  summarise(grew = value_country - lag(value_country)) %>%
  drop_na() %>%
  pull() %>%
  round(1)

tshpdiff <- tshpgrew - tslpgrew
tshpmore <- ifelse(tshpdiff > 0, "grew", "declined")

tslpdiff <- tslpgrew - tslpgrew
tslpmore <- ifelse(tslpdiff > 0, "grew", "declined")

dp21 <- dp21 %>%
  mutate(category = gsub(paste0("^OECD |^", ctry, " "), "", name))

dp21 <- dp21 %>%
  mutate(
    country = str_replace_all(name, " .*", ""),
    category1 = str_sub(category, 1, 2),
    category1 = str_replace_all(category1, "TG", "Tradable goods"),
    category1 = str_replace_all(category1, "TS", "Tradable services"),
    category2 = paste(str_sub(category, 4, 5), time),
    category2 = str_replace_all(category2, "LP", "Low productivity"),
    category2 = str_replace_all(category2, "HP", "High productivity")
  )

dp21_2 <- dp21 %>%
  select(country, time, category1, category2, value_country) %>%
  mutate(
    category2_2 = category2,
    category2 = str_replace_all(category2, as.character(min(yrs)), "minyr"),
    category2 = str_replace_all(category2, as.character(max(yrs)), "maxyr")
  ) %>%
  # remove all after productivy in category2
  # mutate(category2 = str_replace_all(category2, "productivity.*", "productivity")) %>%
  pivot_wider(names_from = category2, values_from = value_country) %>%
  clean_names()

fig4_2 <- dp21_2 %>%
  ggplot() +
  geom_col(
    aes(
      x = country,
      y = high_productivity_minyr,
      fill = category2_2
    ),
    position = position_dodge(width = 0.25)
  ) +
  geom_col(
    aes(
      x = country,
      y = high_productivity_maxyr,
      fill = category2_2
    ),
    position = position_dodge(width = -1)
  ) +
  geom_point(
    aes(
      x = country,
      y = low_productivity_minyr,
      colour = category2_2
    ),
    size = 5,
    shape = 18,
    position = position_dodge(width = -0.66)
  ) +
  geom_point(
    aes(
      x = country,
      y = low_productivity_maxyr,
      colour = category2_2
    ),
    size = 5,
    shape = 18,
    position = position_dodge(width = 0.33)
  ) +
  # theme_oecd(base_size = 10) +
  theme_minimal() +
  scale_color_manual(values = clrs4[1:4]) +
  scale_fill_manual(values = clrs4[1:4]) +
  labs(
    x = "", y = "Employment share (%)", color = "",
    title = "Figure 2: Evolution of sectoral specialisation in tradable sectors,\nTL2 regions"
  ) +
  facet_wrap(~category1) +
  # hide fill from legend
  guides(fill = "none", color = guide_legend(ncol = 2))
```

In `r ctry2`, the share of employment in the TG sector `r tghpmore` by `r abs(tghpgrew)` percentage points in high-productivity regions between `r min(yrs)` and `r max(yrs)`, and it `r tglpmore` by `r abs(tglpgrew)` percentage points in low-productivity ones. At the same the share of employment in TS `r tshpmore` by `r abs(tshpgrew)` percentage points in high-productivity regions between `r min(yrs)` and `r max(yrs)`, and it `r tslpmore` by `r abs(tslpgrew)` percentage points in low-productivity ones.

```{r fig4_2}
ggplotly(fig4_2) %>%
  config(displayModeBar = F)
```

<div class="oecdnote">
**Note**: The employment share for high productivity (low productivity) regions in a given sector is defined as total employment across high productivity (low productivity) regions in a sector/year divided by total employment across high productivity (low productivity) regions in a year. Regions are at the TL2 level for Australia, Canada, Chile, Ireland, Mexico, Norway, Switzerland, Turkey and the United States. A region is defined as high productivity if its productivity was equal or above the country median for at least two years out of the first four years of each region’ observation period, and low productivity otherwise. The tradable goods sector includes Mining and quarrying (B), Manufacturing (C), Electricity, gas, steam and air conditioning supply (D) and Water supply; sewerage; waste management and remediation activities (E) NACE macro sectors. Tradable services include Information and communication (J), Financial and insurance activities (K), Real estate activities (L), Professional, scientific and technical activities (M), Administrative and support service activities (N). The starting year is the first available year for each country.

**Source**: OECD Regional Database (2022).
</div>

## Recent policy developments

```{r cri_txt}
read_html_text(ctry)
```

<table border="1" style="width:75%;margin-left:auto;margin-right:auto;">
  <tr>
    <th style="background:#d4edff; padding:10px;font-size:9.0pt;" valign="center">
      Territorial definitions
    </th>
  </tr>
  <tr>
    <td>
      <p style="padding-left:10px;padding-right:10px;padding-top:10px;font-size:9.0pt;">
        The data in this note reflect different sub-national geographic levels in OECD countries. In particular, <b>regions</b> are classified on two territorial levels reflecting the administrative organisation of countries: large regions (TL2) and small regions (TL3).
      </p>
      <p style="padding-left:10px;padding-right:10px;font-size:9.0pt;">
        Small regions are classified according to their access to metropolitan areas (Fadic et al. 2019). The typology classifies small (TL3) regions into metropolitan and non-metropolitan regions according to the following criteria:
      </p>
      <ul style="list-style-type:circle;font-size:9.0pt;padding-right:10px">
        <li>
          <b>Metropolitan regions</b>, if more than half of the population live in a FUA. Metropolitan regions are further classified into: <b>metropolitan large</b>, if more than half of the population live in a (large) FUA of at least 1.5 million inhabitants; and <b>metropolitan midsize</b>, if more than half of the population live in a (midsize) FUA of at 250 000 to 1.5 million inhabitants.
        </li>
        <li>
          <b>Non-metropolitan regions</b>, if less than half of the population live in a midsize/large FUA. These regions are further classified according to their level of access to FUAs of different sizes: <b>near a midsize/large FUA</b> if more than half of the population live within a 60-minute drive from a midsize/large FUA (of more than 250 000 inhabitants) or if the TL3 region contains more than 80% of the area of a midsize/large FUA; <b>near a small FUA</b> if the region does not have access to a midsize/large FUA and at least half of its population have access to a small FUA (i.e. between 50 000 and 250 000 inhabitants) within a 60-minute drive, or contains 80% of the area of a small FUA; and <b>remote</b>, otherwise.
        </li>
      </ul>
      </p>
      <p style="padding-left:10px;padding-right:10px;font-size:9.0pt;">
        Disclaimer: <a href="https://oecdcode.org/disclaimers/territories.html" target="_blank"><i style="color:#0d6efd">https://oecdcode.org/disclaimers/territories.html</i></a>
      </p>
    </td>
  </tr>
</table>
