```{r mex_ctry}
ctry <- "MEX"
ctry2 <- "Mexico"
```

# Mexico

```{r mex_pkgs, warning=FALSE}
library(oecdcountryprofiles)
library(dplyr)
library(tidyr)
library(ggplot2)
library(patchwork)
library(oecdplot)
library(knitr)
library(readxl)
library(janitor)
library(stringr)
library(readr)
library(tintin)
library(glue)
library(scales)
library(plotly)

load_oecd_fonts()

missing_reg <- c("ITG2F")
excl_countries <- c("LUX", "IRL")

clrs <- tintin_colours$the_black_island
clrs2 <- tintin_colours$the_blue_lotus
clrs3 <- tintin_colours$the_red_sea_sharks
clrs4 <- tintin_colours$the_calculus_affair
clrs5 <- tintin_colours$red_rackhams_treasure
```

<table style="margin-left:66.1pt;border-collapse:collapse" cellspacing="0" cellpadding="0" border="0">
<tbody>
<tr>
<td style="width:467.5pt;border:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt" width="623" valign="top">
<p class="MsoNormal" style="background:#fff9e6">
<b><span style="font-size:9.0pt;color:#212529">OECD Regional Outlook</span></b><u></u><u></u></p>
<p class="MsoNormal" style="margin:2.4pt;background:white"><span style="font-size:9.0pt;color:#212529">The OECD
<a href="https://www.oecd-ilibrary.org/urban-rural-and-regional-development/oecd-regional-outlook_2dafc8cf-en" target="_blank"><i><span style="color:#0d6efd">Regional Outlook</span></i></a> reviews recent trends, policy developments, and prospects across OECD regions, including the underlying causes driving regional inequalities in performance and well-being. The report offers evidence,
 guidance and policy recommendations on how to improve competitiveness and productivity, promote inclusive growth, accelerate the net-zero transition and raise well-being standards through effective regional development policy and multi-level governance.</span><u></u><u></u></p>
</td>
</tr>
</tbody>
</table>

## Overview

```{r mex_tbl}
read_html_table(ctry)
```

## Regional inequality trends

```{r mex_fig1}
iso3_g20 <- read_csv("data/ISO_3_G20.csv") %>%
  clean_names() %>% 
  rename(iso3 = iso_3)

top_bottom_c <- read_excel("data/top_bottom_gdppc_w_agg.xlsx") %>% 
  filter(TIME < 2021) %>% 
  clean_names()

gdp_pop_00_20 <- read_csv("data/gdp_pop_00_20_imputed_agg_l.csv") %>%
  filter(TIME < 2021) %>% 
  clean_names() %>% 
  select(-x1) %>%
  left_join(iso3_g20, by = "iso3") %>%
  filter(!reg_id %in% missing_reg, !iso3 %in% excl_countries) %>%
  mutate(
    metro_large = ifelse(metro_large != "Metropolitan large", "Non-large", metro_large),
    metro_far = ifelse(metro_far != "Far from a FUA>250K", "Close", metro_far)
  ) %>%
  bind_rows(
    read_csv("data/gdp_pop_tl2_00_20_imputed_l_CHL_PACHA.csv") %>%
      filter(TIME < 2021) %>% 
      clean_names() %>%
      select(time, reg_id, iso3, gdp, pop, gdp_pc, regional_name_eng = reg_name)
  )

summary_theil_tl2 <- read_csv("data/theil_gdppc_country_00_20_wCHE-CHL.csv") %>%
  filter(TIME < 2021) %>% 
  clean_names() %>% 
  filter(level == "gdppc_tl2") %>%
  select(-c(x1, level))

# summary_theil_tl2 %>%
#   filter(iso3 == ctry)

summary_stats <- gdp_pop_00_20 %>%
  group_by(iso3, time) %>%
  summarise(mean_gdp_pc = mean(gdp_pc, na.rm = TRUE)) %>%
  ungroup() %>%
  left_join(top_bottom_c, by = c("iso3", "time")) %>%
  mutate(
    top_bottom = top_20_gdppc / bottom_20_gdppc,
    top_mean = top_20_gdppc / mean_gdp_pc,
    bottom_mean = bottom_20_gdppc / mean_gdp_pc
  )

# no gdp data for CHL
# summary_stats %>%
#   filter(iso3 == ctry)

summary_stats <- summary_stats %>%
  full_join(summary_theil_tl2, by = c("iso3", "time"))

# summary_stats %>%
#   filter(iso3 == ctry) %>%
#   select(time, theil)

min_y <- summary_theil_tl2 %>%
  filter(iso3 == ctry) %>%
  pull(time) %>%
  min()

index_200x <- summary_stats %>%
  filter(time == min_y) %>%
  pivot_wider(
    id_cols = "iso3",
    names_from = "time",
    values_from = -c(time, iso3)
  )

# index_200x %>%
#   filter(iso3 == ctry) %>%
#   select(theil_2008)
# => rename cols 

colnames(index_200x) <- gsub("_200[0-9]", "_200x", colnames(index_200x))

summary_stats_index <- summary_stats %>%
  full_join(index_200x, by = "iso3") %>%
  mutate(
    index_gdppc = mean_gdp_pc / mean_gdp_pc_200x,
    index_bottom = bottom_mean / bottom_mean_200x,
    index_top = top_mean / top_mean_200x,
    index_theil = theil / theil_200x,
    index_top_mean = top_mean / top_mean_200x,
    index_bottom_mean = bottom_mean / bottom_mean_200x,
    index_top_bottom = top_bottom / top_bottom_200x
  ) %>%
  select(
    iso3,
    time,
    index_gdppc,
    index_bottom,
    index_top_mean,
    index_top_bottom,
    index_bottom_mean,
    index_top,
    index_theil
  )

summary_wide <- summary_stats_index %>%
  pivot_longer(cols = -c(time, iso3), names_to = "index") %>%
  mutate(
    labels_index = case_when(
      index == "index_bottom" ~ "Bottom 20%",
      index == "index_top" ~ "Top 20%",
      index == "index_bottom_mean" ~ "Bottom 20%/Mean",
      index == "index_top_mean" ~ "Top 20%/Mean",
      index == "index_theil" ~ "Theil index",
      index == "index_gdppc" ~ "Mean GDP per capita",
      index == "index_top_bottom" ~ "Top 20%/Bottom 20%"
    )
  ) %>%
  left_join(iso3_g20, by = "iso3")

lev_2 <- c(
  "Theil index",
  "Mean GDP per capita"
)

max_x <- max(summary_wide$time)
min_x <- min(summary_wide$time)

fig1 <- summary_wide %>%
  filter(iso3 == ctry, labels_index %in% lev_2) %>%
  pivot_wider(
    names_from = index,
    values_from = value
  ) %>%
  mutate(
    index_label = factor(labels_index, levels = lev_2)
  ) %>%
  ggplot(aes(x = time)) +
  geom_line(aes(
    y = index_gdppc,
    colour = index_label
    ), linetype = "dashed", linewidth = 1.2
  ) +
  geom_line(aes(
    y = index_theil,
    colour = index_label
    ), linewidth = 1.2
  ) +
  scale_colour_manual(values = clrs2) +
  scale_x_continuous(expand = c(0, 0),
                     n.breaks = round((max_x-min_x)/2,0)) +
  labs(
    title = "Figure 1: Trends in GDP per capita inequality indicators,\nTL2 OECD regions",
    x = "",
    y = sprintf("Statistic (%s=1)", min_y),
    linetype = "",
    colour = ""
  ) +
  theme_oecd(base_size = 10) +
  theme(plot.title = element_text(size = 13, hjust = 0, margin=margin(0,0,10,0)))
```

```{r mex_fig1_summary}
# range(summary_wide$time) # = 2000-2021!!!
theil_chg <- summary_wide %>%
  # filter in 2 steps to avoid an out of range year
  filter(
    index == "index_theil",
    iso3 == ctry
  ) %>%
  filter(
    time %in% range(time)
  ) %>%
  arrange(time) %>%
  mutate(diff = value - lag(value)) %>%
  filter(time == max(time)) %>%
  pull(diff)

theil_chg_txt <- ifelse(theil_chg > 0, "an increase", "a decline")

theil_max <- summary_wide %>%
  filter(
    index == "index_theil",
    iso3 == ctry
  ) %>%
  filter(value == max(value)) %>%
  pull(time) %>%
  as.integer()

polarization_pct <- summary_wide %>%
  filter(
    index == "index_top_mean",
    iso3 == ctry
  ) %>%
  filter(time %in% range(time)) %>%
  arrange(time) %>%
  mutate(diff = lead(value) - value) %>%
  filter(time == min(time)) %>%
  pull(diff) %>%
  round(3)

polarization_txt <- ifelse(polarization_pct > 0, "higher", "lower")
polarization_txt2 <- ifelse(polarization_txt == "higher", "increased", "decreased")

polarization_yrs <- summary_wide %>%
  filter(
    index == "index_top_mean",
    iso3 == ctry
  ) %>%
  filter(time %in% range(time)) %>%
  pull(time) %>%
  as.integer()

polarization_2_pct <- summary_wide %>%
  filter(
    index == "index_bottom_mean",
    iso3 == ctry
  ) %>%
  filter(
    time %in% range(time)
  ) %>%
  arrange(time) %>%
  mutate(diff = lead(value) - value) %>%
  filter(time == min(time)) %>%
  pull(diff) %>%
  round(3)

polarization_2_txt <- ifelse(polarization_2_pct > 0, "higher", "lower")
polarization_2_txt2 <- ifelse(polarization_2_txt == "higher", "convergence", "divergence")

polarization_yrs_txt <- summary_wide %>%
  filter(
    index == "index_bottom_mean",
    iso3 == ctry
  ) %>%
  filter(
    time %in% range(time)
  ) %>%
  arrange(time) %>%
  pull(time) %>%
  as.character()

# not all countries have polarization data
theil_paragraph <- glue("{ctry2} experienced {theil_chg_txt} in the Theil index of GDP per capita over {polarization_yrs_txt[1]}-{polarization_yrs_txt[2]}. Inequality reached its maximum in {theil_max}. The figures are normalized, with values in the year {as.integer(min_y)} set to 1.")

theil_paragraph_2 <- if (is.na(polarization_2_pct)) {
  ""
} else {
  glue("Polarisation, as measured by the Top 20%/Mean ratio was { paste(abs(polarization_pct), polarization_txt) } in { max(polarization_yrs) } compared to { min(polarization_yrs) }, indicating { polarization_txt2 } polarisation. Bottom divergence, as measured by the Bottom 20%/Mean ratio was { paste(abs(polarization_2_pct), polarization_2_txt) } in the same period, indicating bottom { polarization_2_txt2 }.")
}
```

`r theil_paragraph`

`r theil_paragraph_2`

```{r mex_fig1_1}
# no interactivity
# fig1

# interactivity
ggplotly(fig1) %>%
  config(displayModeBar = F)
```

<div class="oecdnote">
**Source**: OECD Regional Database (2022).
</div>

```{r mex_fig2}
# read ----

finp <- if (any(ctry %in% c("AUS", "CAN", "COL", "CHE", "CHL", "IRL", "MEX"))) {
  "data/countryprofile_option1_addon.xlsx"
} else {
  "data/countryprofile_option1.xlsx"
}

dp1 <- read_excel(finp, sheet = ctry) %>%
  clean_names()

# tidy ----

colnames(dp1) <- str_replace(colnames(dp1), tolower(ctry), "country")

dp11 <- dp1 %>%
  select(time, matches("country")) %>%
  pivot_longer(-time) %>%
  rename(value_country = value)

dp11 <- dp11 %>%
  mutate(
    name = case_when(
      name == "pw_lp_country" ~ "Lower Productivity",
      name == "pw_hp_country" ~ "Higher Productivity"
    )
  )

# plot ----

yrs <- sort(unique(dp11$time))
yrs <- seq(min(yrs), max(yrs), 2)

hpgrew <- dp11 %>% 
  filter(
    name == "Higher Productivity",
    time %in% c(min(yrs), max(yrs))
  ) %>% 
  summarise(grew = 100 * (value_country - lag(value_country)) / lag(value_country)) %>% 
  drop_na() %>% 
  pull() %>% 
  round(1)

lpgrew <- dp11 %>% 
  filter(
    name == "Lower Productivity",
    time %in% c(min(yrs), max(yrs))
  ) %>% 
  summarise(grew = 100 * (value_country - lag(value_country)) / lag(value_country)) %>% 
  drop_na() %>% 
  pull() %>% 
  round(1)

hpdiff <- hpgrew - lpgrew

hpmore <- ifelse(hpdiff > 0, "more", "less")

fig2 <- dp11 %>%
  rename(
    value = value_country,
    series = name
  ) %>%
  ggplot() +
  geom_line(aes(x = time, y = value, color = series), linewidth = 1.2) +
  theme_oecd(base_size = 10) +
  scale_colour_manual(values = clrs3[1:2]) +
  labs(x = "", y = "Productivity (2015 USD PPP)", colour = "Series",
       title = "Figure 2: Evolution of labour productivity, TL2 regions") +
  scale_x_continuous(labels = as.character(yrs), breaks = yrs) +
  scale_y_continuous(labels = scales::number_format()) +
  theme(plot.title = element_text(size = 13, hjust = 0, margin=margin(0,0,10,0)),
        legend.title= element_blank())

ctry3 <- if (any(ctry %in% c("USA", "GBR", "CZE", "SVK", "NLD"))) {
  paste("The", ctry2)
} else {
  ctry2
}

ctry4 <- if (any(ctry %in% c("USA", "GBR", "CZE", "SVK", "NLD"))) {
  paste("the", ctry2)
} else {
  ctry2
}

labour_paragraph <- glue("In { ctry3 }, labour productivity in higher productivity regions grew by { hpgrew }% between { min(yrs) } and { max(yrs)}, { abs(hpdiff) } percentage points { hpmore } compared to lower productivity regions.")
```

`r labour_paragraph`

```{r mex_fig2_2}
# no interactivity
# fig2

# interactivity
ggplotly(fig2) %>%
  config(displayModeBar = F)
```

<div class="oecdnote">
**Note**: Labour productivity for higher productivity (lower productivity) regions is equal to the sum of Gross Value Added across higher productivity (lower productivity) regions in a country/year divided by the sum of Employment across higher productivity (lower productivity) regions in a country/year. Gross Value Added is expressed in USD 2015 PPP. Regions are at the TL2 level for Australia, Canada, Chile, Colombia, Ireland, Mexico, Norway, Switzerland, Turkey and the United States. A region is defined as having higher productivity if its productivity was equal or above the country median for at least two years out of the first four years of each region’ observation period, and as having lower productivity otherwise. The starting year is the first available year of data for each country.

**Source**: OECD Regional Database (2022).
</div>

```{r mex_fig3}
# read ----

finp <- if (any(ctry %in% c("AUS", "CAN", "COL", "CHE", "CHL", "IRL", "MEX"))) {
  "data/countryprofile_option2_addon.xlsx"
} else {
  "data/countryprofile_option2.xlsx"
}

dp2 <- read_excel(finp, sheet = ctry) %>% 
  clean_names()

# tidy ----

colnames(dp2) <- str_replace(colnames(dp2), tolower(ctry), "country")

dp21 <- dp2 %>%
  select(time, matches("country")) %>%
  pivot_longer(-time) %>%
  rename(value_country = value)

dp21 <- dp21 %>%
  mutate(
    name = case_when(
      name == "share_tgoods_lp_country" ~ paste(ctry, "TG LP"),
      name == "share_tgoods_hp_country" ~ paste(ctry, "TG HP"),
      name == "share_tserv_lp_country" ~ paste(ctry, "TS LP"),
      name == "share_tserv_hp_country" ~ paste(ctry, "TS HP")
    )
  )

# plot ----

yrs <- sort(unique(dp21$time))
yrs <- seq(min(yrs), max(yrs), 1)

tghpgrew <- dp21 %>% 
  filter(
    name == paste(ctry, "TG HP"),
    time %in% c(min(yrs), max(yrs))
  ) %>% 
  summarise(grew = value_country - lag(value_country)) %>% 
  drop_na() %>% 
  pull() %>% 
  round(1)

tglpgrew <- dp21 %>% 
  filter(
    name == paste(ctry, "TG LP"),
    time %in% c(min(yrs), max(yrs))
  ) %>% 
  summarise(grew = value_country - lag(value_country)) %>% 
  drop_na() %>% 
  pull() %>% 
  round(1)

tghpdiff <- tghpgrew - tglpgrew
tghpmore <- ifelse(tghpdiff > 0, "grew", "declined")

tglpdiff <- tglpgrew - tglpgrew
tglpmore <- ifelse(tglpdiff > 0, "grew", "declined")

tshpgrew <- dp21 %>% 
  filter(
    name == paste(ctry, "TS HP"),
    time %in% c(min(yrs), max(yrs))
  ) %>% 
  summarise(grew = value_country - lag(value_country)) %>% 
  drop_na() %>% 
  pull() %>% 
  round(1)

tslpgrew <- dp21 %>% 
  filter(
    name == paste(ctry, "TS LP"),
    time %in% c(min(yrs), max(yrs))
  ) %>% 
  summarise(grew = value_country - lag(value_country)) %>% 
  drop_na() %>% 
  pull() %>% 
  round(1)

tshpdiff <- tshpgrew - tslpgrew
tshpmore <- ifelse(tshpdiff > 0, "grew", "declined")

tslpdiff <- tslpgrew - tslpgrew
tslpmore <- ifelse(tslpdiff > 0, "grew", "declined")

dp21 <- dp21 %>% 
  mutate(category = gsub(paste0("^OECD |^", ctry, " "), "", name))

dp21 <- dp21 %>%
  mutate(
    country = str_replace_all(name, " .*", ""),
    
    category1 = str_sub(category, 1, 2),
    category1 = str_replace_all(category1, "TG", "Tradable goods"),
    category1 = str_replace_all(category1, "TS", "Tradable services"),

    category2 = paste(str_sub(category, 4, 5), time),
    category2 = str_replace_all(category2, "LP", "Low productivity"),
    category2 = str_replace_all(category2, "HP", "High productivity")
  )

dp21_2 <- dp21 %>%
  select(country, time, category1, category2, value_country) %>%
  mutate(
    category2_2 = category2,
    category2 = str_replace_all(category2, as.character(min(yrs)), "minyr"),
    category2 = str_replace_all(category2, as.character(max(yrs)), "maxyr")
  ) %>%
  # remove all after productivy in category2
  #mutate(category2 = str_replace_all(category2, "productivity.*", "productivity")) %>%
  pivot_wider(names_from = category2, values_from = value_country) %>%
  clean_names()

fig3 <- dp21_2 %>% 
  rename(
    series = category2_2,
    hp_min_y = high_productivity_minyr,
    hp_max_y = high_productivity_maxyr,
    lp_min_y = low_productivity_minyr,
    lp_max_y = low_productivity_maxyr
  ) %>%
  ggplot() +
  geom_col(aes(x = country,
    y = hp_min_y,    
    fill = series),
    position = position_dodge(width=0.25)) +
  geom_col(aes(x = country,
    y = hp_max_y,    
    fill = series),
    position = position_dodge(width=-1)) +
  geom_point(aes(x = country,
    y = lp_min_y,
    colour = series),
    size = 5,
    shape = 18,
    position = position_dodge(width=-0.66)) +
  geom_point(aes(x = country,
    y = lp_max_y,
    colour = series),
    size = 5,
    shape = 18,
    position = position_dodge(width=0.33)) +
  theme_oecd(base_size = 10) +
  scale_color_manual(values = clrs4[1:4]) +
  scale_fill_manual(values = clrs4[1:4]) +
  labs(x = "", y = "Employment share (%)", color = "",
       title = "Figure 3: Evolution of sectoral specialisation in tradable sectors,\nTL2 regions") +
  facet_wrap(~category1) +
  # hide fill from legend
  guides(fill = "none", color=guide_legend(ncol=2)) +
  theme(plot.title = element_text(size = 13, hjust = 0, margin=margin(0,0,10,0)),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank())

# for plot_ly -----
dp21_2 <- dp21 %>%
  select(country, time, category1, category2, value_country) %>%
  mutate(type = ifelse(str_detect(category2, "Lower"), "Lower productivity", "Higher productivity"))

dp21_min_TG <- dp21 %>%
  select(country, time, category1, category2, value_country) %>%
  mutate(type = ifelse(str_detect(category2, "Lower"), "Lower productivity", "Higher productivity")) %>% 
  filter(time == min(dp21_2$time) & category1 == "Tradable goods")

dp21_min_TS <- dp21 %>%
  select(country, time, category1, category2, value_country) %>%
  mutate(type = ifelse(str_detect(category2, "Lower"), "Lower productivity", "Higher productivity")) %>% 
  filter(time == min(dp21_2$time) & category1 == "Tradable services")

dp21_max_TG <- dp21 %>%
  select(country, time, category1, category2, value_country) %>%
  mutate(type = ifelse(str_detect(category2, "Lower"), "Lower productivity", "Higher productivity")) %>% 
  filter(time == max(dp21_2$time) & category1 == "Tradable goods")

dp21_max_TS <- dp21 %>%
  select(country, time, category1, category2, value_country) %>%
  mutate(type = ifelse(str_detect(category2, "Lower"), "Lower productivity", "Higher productivity")) %>% 
  filter(time == max(dp21_2$time) & category1 == "Tradable services")

data_plotly <- tibble(
  "x" = c("Lower productivity", "Higher productivity"),
  "y" = dp21_min_TG$value_country,
  "y2" = dp21_min_TS$value_country,
  "y3" = dp21_max_TG$value_country,
  "y4" = dp21_max_TS$value_country,
  "name1" = dp21_min_TG$category2,
  "name2" = dp21_max_TG$category2
)

x = c("Lower productivity", "Higher productivity")
y = dp21_min_TG$value_country
y2 = dp21_min_TS$value_country
y3 = dp21_max_TG$value_country
y4 = dp21_max_TS$value_country
name1 = dp21_min_TG$category2
name2 = dp21_max_TG$category2


p1 <- plot_ly() %>% add_trace(x = ~x, y = ~y, color = ~x,
                              type = 'bar',
                         # text = y, 
                         # textposition = 'auto',
                         name = ~name1,
                         marker = list(color = clrs4[1:2] #,
                                       # line = list(color = 'rgb(8,48,107)', width = 1.5)
                         ))

p1 <- p1 %>% add_markers(x = ~x, y = ~y3, color = ~x,
                           name = ~name2,
                           mode = "markers", 
                           marker = list(color = c("#6bc5f2", "#c8f075"),
                                         size = 12,
                                         symbol = "diamond-dot"))
p1 <- p1 %>% layout(title = "Tradable goods",
                    xaxis = list(title = "", visible = FALSE),
                    yaxis = list(title = "Employment share (%)"),
                    legend = list(bgcolor = 'rgb(242, 242, 242)'))

p2 <- plot_ly() %>% add_trace(x = ~x, y = ~y2, color = ~x,
                              type = 'bar',
                              marker = list(color = clrs4[1:2]),
                              showlegend = FALSE)

p2 <- p2 %>% add_markers(x = ~x, y = ~y4, color = ~x,
                         mode = "markers", 
                         marker = list(color = c("#6bc5f2", "#c8f075"),
                                       size = 12,
                                       symbol = "diamond-dot"), 
                         showlegend = FALSE)
p2 <- p2 %>% layout(title = "Tradable services",
                    xaxis = list(title = "", visible = FALSE),
                    yaxis = list(title = "Employment share (%)"))


p <- subplot(p1,p2,nrows = 1, margin = 0.05, shareX = TRUE, shareY = TRUE) 

p <- p %>% 
  layout(
    title = list(text = "Figure 3: Evolution of sectoral specialisation in tradable sectors,\nTL2 regions \n", x = 0), 
    margin = list(l = 50, r = 50,
                  b = 50, t = 120,
                  pad = 4),
    annotations = list(
      list(
        x = 0.25,
        y = 1,
        font = list(size = 14),
        text = "Tradable goods",
        xref = "paper",
        yref = "paper",
        xanchor = "center",
        yanchor = "bottom",
        showarrow = FALSE
      ),
      list(
        x = 0.75,
        y = 1,
        font = list(size = 14),
        text = "Tradable services",
        xref = "paper",
        yref = "paper",
        xanchor = "center",
        yanchor = "bottom",
        showarrow = FALSE
      )))

```

In `r ctry3`, the share of employment in the tradable goods sector `r tghpmore` by `r abs(tghpgrew)` percentage points in high-productivity regions between `r min(yrs)` and `r max(yrs)`, and it `r tglpmore` by `r abs(tglpgrew)` percentage points in low-productivity ones. At the same time the share of employment in tradable services `r tshpmore` by `r abs(tshpgrew)` percentage points in high-productivity regions between `r min(yrs)` and `r max(yrs)`, and it `r tslpmore` by `r abs(tslpgrew)` percentage points in low-productivity ones.

```{r mex_fig3_2}
p
```

<div class="oecdnote">
**Note**: The employment share for high productivity (low productivity) regions in a given sector is defined as total employment across high productivity (low productivity) regions in a sector/year divided by total employment across high productivity (low productivity) regions in a year. Regions are at the TL2 level for Australia, Canada, Chile, Ireland, Mexico, Norway, Switzerland, Turkey and the United States. A region is defined as high productivity if its productivity was equal or above the country median for at least two years out of the first four years of each region’ observation period, and low productivity otherwise. The tradable goods sector includes Mining and quarrying (B), Manufacturing (C), Electricity, gas, steam and air conditioning supply (D) and Water supply; sewerage; waste management and remediation activities (E) NACE macro sectors. Tradable services include Information and communication (J), Financial and insurance activities (K), Real estate activities (L), Professional, scientific and technical activities (M), Administrative and support service activities (N). The starting year is the first available year of data for each country.
**Source**: OECD Regional Database (2022).
</div>

## Recent policy developments

```{r mex_txt}
read_html_text(ctry)
```

<br>
<table style="margin-left:66.1pt;border-collapse:collapse" cellspacing="0" cellpadding="0" border="0">
<tbody>
<tr>
<td style="width:467.5pt;border:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt" width="623" valign="top">
<p class="MsoNormal" style="background:#d4edff"><b><span style="font-size:9.0pt;color:#212529">Territorial definitions</span></b><u></u><u></u></p>
<p class="MsoNormal" style="margin:2.4pt;background:white"><span style="font-size:9.0pt;color:#212529">The data in this note reflect different sub-national geographic levels in OECD countries:</span>
<ul style=“list-style-type:circle;font-size:9.0pt;color:#212529”>
<li><strong>Regions</strong>: are classified on two territorial levels reflecting the administrative organisation of countries: large regions (TL2) and small regions (TL3). Small regions are classified according to their access to metropolitan areas (Fadic et al. 2019).</li>
<li><strong>Functional urban areas</strong> consist of cities – defined as densely populated local units with at least 50 000 inhabitants – and adjacent local units connected to the city (commuting zones) in terms of commuting flows (Dijkstra, Poelman, and Veneri 2019). Metropolitan areas refer to functional urban areas above 250 000 inhabitants.</li></ul></p>

<p class="MsoNormal" style="margin:2.4pt;background:white"><span style="font-size:9.0pt;color:#212529">In addition, some indicators use the degree of urbanisation classification (OECD et al. 2021), which defines three types of areas:</span>
<ul style=“list-style-type:circle;font-size:9.0pt;color:#212529”>
<li><strong>Cities</strong> consist of contiguous grid cells that have a density of at least 1 500 inhabitants per km2 or are at least 50% built up, with a population of at least 50 000.</li>
<li><strong>Towns and semi-dense areas</strong> consist of contiguous grid cells with a density of at least 300 inhabitants per km2 and are at least 3% built up, with a total population of at least 5 000.</li>
<li><strong>Rural areas</strong> are cells that do not belong to a city or a town and semi-dense area. Most of these have a density below 300 inhabitants per km2.</li></ul></p>

<p class="MsoNormal" style="margin:2.4pt;background:white"><span style="font-size:9.0pt;color:#212529">Disclaimer: <a href="https://oecdcode.org/disclaimers/territories.html" target="_blank"><i><span style="color:#0d6efd">https://oecdcode.org/disclaimers/territories.html</span></i></a></span><u></u><u></u></p>
</td>
</tr>
</tbody>
</table>